<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAMISAS 10</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column; /* Manter como coluna para empilhar se√ß√µes */
        }

        .header {
            background: url('https://images.unsplash.com/photo-1517649762945-04ce191ade63?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center;
            background-size: cover;
            color: white;
            text-align: center;
            padding: 30px;
            position: relative;
            overflow: hidden;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
        }

        /* Overlay para legibilidade do texto */
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(71, 165, 75, 1);
            z-index: 1;
        }

        /* Os √≠cones agora s√£o elementos pr√≥prios, n√£o pseudo-elementos do header */
        .header .icon-element {
            position: absolute;
            font-size: 80px; /* Tamanho dos √≠cones */
            opacity: 0.15; /* Um pouco mais vis√≠vel */
            z-index: 2; /* Acima do overlay */
        }

        .header .icon-cup { /* √çcone da ta√ßa */
            /*top: 10px;*/
            /*left: 10px;*/
            /*content: 'üèÜ';*/ /* √çcone para a ta√ßa */
            /*font-size: 60px;*/ /* Ta√ßa um pouco menor */
			content: 'üèÜ';
            position: absolute;
            font-size: 120px;
            opacity: 0.1;
            left: -10px;
            bottom: -10px;
            transform: rotate(-30deg);
        }

        .header .icon-ball { /* √çcone da bola */
            bottom: 0px; /* Posicionamento inicial ajustado */
            right: 0px;
            content: '‚öΩ'; /* √çcone para a bola */
            font-size: 100px; /* Bola maior */
            animation: circularSpin 6s infinite linear; /* Nome da anima√ß√£o alterado e velocidade */
            transform-origin: center center;
        }

        /* Keyframes para a anima√ß√£o da bola (NOVA ANIMA√á√ÉO) */
        @keyframes circularSpin {
            0% {
                transform: translate(0, 0) rotate(0deg); /* Come√ßa no canto inferior direito */
                opacity: 0.15;
            }
            25% {
                transform: translate(-100px, -50px) rotate(90deg); /* Move para cima e esquerda */
                opacity: 0.25;
            }
            50% {
                transform: translate(-200px, 0) rotate(180deg); /* Move para a esquerda */
                opacity: 0.35;
            }
            75% {
                transform: translate(-100px, 50px) rotate(270deg); /* Move para baixo e direita */
                opacity: 0.25;
            }
            100% {
                transform: translate(0, 0) rotate(360deg); /* Volta √† posi√ß√£o inicial */
                opacity: 0.15;
            }
        }

        /* Ajuste para que o h1 e p fiquem acima de tudo */
        .header h1, .header p {
            position: relative;
            z-index: 3;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
        }

        .card {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            padding: 25px;
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input[type="text"],
        .form-group input[type="password"],
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="password"]:focus,
        .form-group select:focus {
            border-color: #667eea;
            outline: none;
        }

        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #333;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-primary {
            background-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0069d9;
        }

        .connection-status {
            padding: 10px;
            margin-top: 15px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            /* Removido display: none; para sempre mostrar o status */
            display: block; /* Mudar para block para que seja sempre vis√≠vel */
        }

        .status-loading {
            background-color: #e0f7fa;
            color: #00796b;
        }

        .status-connected {
            background-color: #e6ffe6;
            color: #2e7d32;
        }

        .status-error {
            background-color: #ffebee;
            color: #c62828;
        }

        #playersList {
            margin-top: 20px;
        }

        #playersList > div {
            padding: 15px;
            background-color: #f8f8f8;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        #playersList ul {
            list-style: none;
            padding: 0;
        }

        #playersList li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #playersList li:last-child {
            border-bottom: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            text-align: left;
            padding: 12px 15px;
            border-bottom: 1px solid #f2f2f2;
        }

        th {
            background-color: #f4f4f4;
            color: #555;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }
        
        #teamsContainer {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        #teamsContainer h3 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        #teamsContainer ul {
            list-style: none;
            padding: 0;
            background-color: #f0f8ff;
            border: 1px solid #b0e0e6;
            border-radius: 8px;
            padding: 15px;
            min-height: 150px;
        }

        #teamsContainer li {
            padding: 8px 0;
            border-bottom: 1px dashed #c0e0e6;
            font-size: 1.1em;
            color: #444;
        }

        #teamsContainer li:last-child {
            border-bottom: none;
        }

        #resultSection {
            display: none;
            margin-top: 20px;
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
            text-align: center;
        }

        .stat-item {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-item h4 {
            color: #388e3c;
            margin-bottom: 5px;
        }

        .stat-item p {
            font-size: 1.8em;
            font-weight: bold;
            color: #4CAF50;
        }

        .reset-button-container {
            margin-top: 30px;
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .teams-fixed-container {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .team-fixed-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .team-fixed-card ul {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }

        .team-fixed-card li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-fixed-card li:last-child {
            border-bottom: none;
        }
        
        .modern-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background-color: #ffffff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .modern-table thead th {
            background-color: #f8f8f8;
            color: #555;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
            padding: 15px 20px;
            text-align: left;
            border-bottom: 2px solid #eeeeee;
        }

        .modern-table tbody tr {
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .modern-table tbody tr:nth-child(even) {
            background-color: #fdfdfd;
        }

        .modern-table tbody tr:hover {
            background-color: #f0f8ff;
            transform: scale(1.005);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .modern-table tbody td {
            padding: 12px 20px;
            border-bottom: 1px solid #f5f5f5;
            color: #444;
            font-size: 1em;
        }

        .modern-table tbody td strong {
            color: #4CAF50;
            font-size: 1.15em;
        }

        .pos-badge-minimal {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 0.85em;
            font-weight: bold;
            color: white;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .pos-badge-minimal.pos-1 { background-color: #FFD700; }
        .pos-badge-minimal.pos-2 { background-color: #C0C0C0; }
        .pos-badge-minimal.pos-3 { background-color: #CD7F32; }
        .pos-badge-minimal.pos-default { background-color: #bbbbbb; }

        .modern-table tbody tr.top-rank-row {
            border-left: 5px solid;
        }
        .modern-table tbody tr.top-rank-row.pos-1 { border-color: #FFD700; }
        .modern-table tbody tr.top-rank-row.pos-2 { border-color: #C0C0C0; }
        .modern-table tbody tr.top-rank-row.pos-3 { border-color: #CD7F32; }

        .modern-table tbody tr.top-rank-row td:first-child {
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        
        #reservesSection h2 {
            color: #2E7D32;
            border-bottom: 2px solid #81C784;
        }

        #reservesList li {
            padding: 8px 0;
            border-bottom: 1px dashed #A5D6A7;
            font-size: 1.1em;
            color: #4CAF50;
        }

        #reservesList li:last-child {
            border-bottom: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>Liga Individual - CAMISAS 10</h1>
            <p>Que ven√ßa o melhor!</p>
            <span class="icon-element icon-cup">üèÜ</span>
            <span class="icon-element icon-ball">‚öΩ</span>
        </header>

        <main class="main-content">
            <section class="card" id="playerManagementSection">
                <h2>‚ûï Adicionar Jogador</h2>
                <div class="form-group">
                    <label for="newPlayerName">Nome do Jogador:</label>
                    <input type="text" id="newPlayerName" placeholder="Nome do jogador">
                </div>
                <button class="btn" onclick="window.addPlayer()">Adicionar Jogador</button>

                <h2 style="margin-top: 30px;">üë• Jogadores Cadastrados</h2>
                <div id="playersList">
                    <p>Nenhum jogador cadastrado.</p>
                </div>
            </section>

            <section class="card" id="drawSection">
                <h2>üéØ Sorteio de Times</h2>
                <div class="teams-fixed-container">
                    <div class="team-fixed-card">
                        <h3>Jogadores Fixos - Time A</h3>
                        <ul id="fixedTeamA_list">
                        </ul>
                    </div>
                    <div class="team-fixed-card">
                        <h3>Jogadores Fixos - Time B</h3>
                        <ul id="fixedTeamB_list">
                        </ul>
                    </div>
                </div>

                <button class="btn" id="drawButton" onclick="window.drawTeams()" disabled>
                    üö´ Adicione jogadores para sortear (0/12)
                </button>

                <div id="teamsContainer">
                    <div class="team-card">
                        <h3>Time A</h3>
                        <ul id="teamA"></ul>
                    </div>
                    <div class="team-card">
                        <h3>Time B</h3>
                        <ul id="teamB"></ul>
                    </div>
                </div>

                <div id="resultSection">
                    <h3 class="section-title">üìä Registrar Resultado</h3>
                    <div class="form-group">
                        <label for="gameResult">Vencedor:</label>
                        <select id="gameResult">
                            <option value="">Selecione o resultado</option>
                            <option value="teamA">Time A</option>
                            <option value="teamB">Time B</option>
                            <option value="draw">Empate</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="window.registerResult()">Registrar Resultado</button>
                </div>
            </section>

            <section class="card" id="reservesSection" style="display: none;">
                <h2>üë• Jogadores no Banco / N√£o Selecionados</h2>
                <ul id="reservesList">
                </ul>
            </section>

            <section class="card" id="rankingSection">
                <h2>üèÜ Classifica√ß√£o Geral</h2>
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>Pos.</th>
                            <th>Nome</th>
                            <th>Pts</th>
                            <th>V</th>
                            <th>E</th>
                            <th>D</th>
                        </tr>
                    </thead>
                    <tbody id="rankingTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #777;">Carregando classifica√ß√£o...</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="card" id="statsSection">
                <h2>üìà Estat√≠sticas</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <h4>Total de Jogadores</h4>
                        <p id="totalPlayers">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>L√≠der em Pontos</h4>
                        <p id="leaderPoints">0</p>
                    </div>
                </div>
            </section>

            <div id="connectionStatus" class="connection-status"></div>
            <section class="card reset-button-container" id="dataManagementSection" style="display:none">
                <h2>‚ö†Ô∏è Gerenciamento de Dados</h2>
                <button class="btn btn-danger" onclick="window.resetAllData()">Resetar Todos os Dados</button>
            </section>
        </main>
    </div>

   <script>
    // ================================
    // CONFIGURA√á√ÉO SUPABASE (FRONTEND)
    // ================================
    const SUPABASE_URL = 'https://ofdaxmhklseogkfsvmdx.supabase.co';
    const SUPABASE_PUBLISHABLE_KEY = 'sb_publishable_CuTQDFD26fEkDJqzXrLL7g_aIBBbnvD';

    let supabase = null;
    let players = [];
    let currentTeamA = [];
    let currentTeamB = [];
    let fixedTeamA = [];
    let fixedTeamB = [];
    let isConnected = false;

    // ================================
    // INICIALIZA√á√ÉO
    // ================================
    document.addEventListener('DOMContentLoaded', async function () {
        console.log("P√°gina carregada. Iniciando conex√£o segura...");
        await connectSupabase();

        restoreDrawFromLocalStorage();
    });

    // ================================
    // CONEX√ÉO SUPABASE (APENAS PUBLISHABLE)
    // ================================
    async function connectSupabase() {
        try {
            if (!window.supabase) {
                throw new Error("SDK Supabase n√£o carregado.");
            }

            supabase = window.supabase.createClient(
                SUPABASE_URL,
                SUPABASE_PUBLISHABLE_KEY,
                {
                    auth: {
                        persistSession: false
                    }
                }
            );

            // Teste simples
            const { error } = await supabase
                .from('jogadores')
                .select('id')
                .limit(1);

            if (error) throw error;

            isConnected = true;
            showStatus('‚úÖ Conectado ao Supabase com Publishable Key!', 'connected');

            await loadData();

        } catch (error) {
            console.error("Erro na conex√£o:", error);
            showStatus(`‚ùå Erro ao conectar: ${error.message}`, 'error');
            isConnected = false;
        }
    }

    // ================================
    // STATUS
    // ================================
    function showStatus(message, type) {
        const statusDiv = document.getElementById('connectionStatus');
        statusDiv.textContent = message;
        statusDiv.className = `connection-status status-${type}`;
    }

    // ================================
    // RESTAURAR TIMES DO LOCALSTORAGE
    // ================================
    function restoreDrawFromLocalStorage() {
        const savedTeamA = localStorage.getItem('savedCurrentTeamA');
        const savedTeamB = localStorage.getItem('savedCurrentTeamB');
        const savedReserves = localStorage.getItem('savedPlayersNotInGame');
        const hasDrawn = localStorage.getItem('hasDrawnTeams');

        if (savedTeamA && savedTeamB && hasDrawn === 'true') {
            currentTeamA = JSON.parse(savedTeamA);
            currentTeamB = JSON.parse(savedTeamB);
            const playersNotInGame = savedReserves ? JSON.parse(savedReserves) : [];

            displayTeams(playersNotInGame);
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('drawButton').disabled = true;
            document.getElementById('drawButton').innerHTML = 'üéØ Times Sorteados';
        }
    }

    // ================================
    // CARREGAR DADOS
    // ================================
    async function loadData() {
        if (!isConnected) return;

        try {
            showStatus('üì• Carregando jogadores...', 'loading');

            const { data, error } = await supabase
                .from('jogadores')
                .select(`
                    id,
                    name,
                    active_for_draw,
                    posicao (
                        pontos,
                        vitorias,
                        derrotas,
                        empates
                    )
                `);

            if (error) throw error;

            players = data.map(j => ({
                id: j.id,
                name: j.name,
                points: j.posicao?.[0]?.pontos ?? 0,
                wins: j.posicao?.[0]?.vitorias ?? 0,
                draws: j.posicao?.[0]?.empates ?? 0,
                losses: j.posicao?.[0]?.derrotas ?? 0,
                activeForDraw: j.active_for_draw ?? true
            }));

            updateRanking();
            updateStats();
            updatePlayersList();
            checkDrawButtonState();

            showStatus('‚úÖ Dados carregados!', 'connected');

        } catch (error) {
            showStatus(`‚ùå Erro ao carregar: ${error.message}`, 'error');
        }
    }

    // ================================
    // ADICIONAR JOGADOR
    // ================================
    async function addPlayer() {
        if (!isConnected) return alert("N√£o conectado.");

        const name = document.getElementById('newPlayerName').value.trim();
        if (!name) return alert("Digite o nome.");

        try {
            const { data, error } = await supabase
                .from('jogadores')
                .insert([{
                    name,
                    dtRegistro: new Date().toISOString(),
                    active_for_draw: true
                }])
                .select();

            if (error) throw error;

            const jogadorId = data[0].id;

            await supabase.from('posicao').insert([{
                idJogador: jogadorId,
                pontos: 0,
                vitorias: 0,
                derrotas: 0,
                empates: 0
            }]);

            document.getElementById('newPlayerName').value = '';
            await loadData();
            alert("Jogador adicionado!");

        } catch (error) {
            alert(error.message);
        }
    }

    // ================================
    // ATUALIZAR RANKING
    // ================================
    function updateRanking() {
        const sorted = [...players]
            .filter(p => !p.name.toLowerCase().includes('avulso'))
            .sort((a, b) =>
                b.points - a.points ||
                b.wins - a.wins ||
                b.draws - a.draws
            );

        const tbody = document.getElementById('rankingTableBody');
        tbody.innerHTML = '';

        sorted.forEach((p, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${p.name}</td>
                <td><strong>${p.points}</strong></td>
                <td>${p.wins}</td>
                <td>${p.draws}</td>
                <td>${p.losses}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // ================================
    // ESTAT√çSTICAS
    // ================================
    function updateStats() {
        document.getElementById('totalPlayers').textContent = players.length;
        const maxPoints = players.length > 0 ? Math.max(...players.map(p => p.points)) : 0;
        document.getElementById('leaderPoints').textContent = maxPoints;
    }

    // ================================
    // EXPOR FUN√á√ïES PARA HTML
    // ================================
    window.addPlayer = addPlayer;
</script>
</body>

</html>;
